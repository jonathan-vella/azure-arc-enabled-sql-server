# Template Files and Security

Version: v1.2025.12
Last updated: 2025-12-16

This document explains the template file system used in this repository to prevent accidental commits of sensitive data while maintaining helpful examples.

## Overview

Several scripts in this repository generate output files containing sensitive information (credentials, workspace keys, etc.). To help users understand the structure of these files without exposing real data, we provide `.example.json` template files.

## Template File Pattern

### Naming Convention
- **Real files** (excluded from repo): `filename.json`
- **Template files** (committed to repo): `filename.example.json`

### How It Works

1. **Template files** (`.example.json`) are committed to the repository
   - Show the structure and fields users can expect
   - Use placeholder values (e.g., `00000000-0000-0000-0000-000000000000` for GUIDs)
   - Safe to commit and share publicly

2. **Real files** are generated by scripts during execution
   - Contain actual sensitive data (secrets, keys, credentials)
   - Automatically excluded via `.gitignore`
   - Should be stored securely and deleted after use

## Protected Files

### Lab Infrastructure (`arc-sql-hands-on-lab/`)

| Real File (Ignored) | Template File (Committed) | Generated By | Contains |
|---------------------|---------------------------|--------------|----------|
| `bicep/deployment-outputs.json` | `bicep/deployment-outputs.example.json` | `deploy.ps1` | Workspace IDs, keys, resource names |
| `scripts/service-principal-credentials.json` | `scripts/service-principal-credentials.example.json` | `Create-ArcServicePrincipal.ps1` | Service principal ID and secret |
| `scripts/connectivity-report-*.json` | `scripts/connectivity-report.example.json` | `Test-ArcConnectivity.ps1` | Network connectivity results |

### Server Onboarding (`arc-server-onboarding-automation/`)

| Real File (Ignored) | Template File (Committed) | Contains |
|---------------------|---------------------------|----------|
| `scripts/test_cmdb.csv` | `scripts/CMDB.csv` | Customer tenant data, credentials |

## .gitignore Configuration

The `.gitignore` file is configured with:

```gitignore
# Ignore real credential files
service-principal-credentials.json
deployment-outputs.json
connectivity-report-*.json

# Allow template files
!service-principal-credentials.example.json
!deployment-outputs.example.json
!connectivity-report.example.json

# Preserve template CMDB
!arc-server-onboarding-automation/scripts/CMDB.csv
```

## Security Best Practices

### ✅ DO:
- ✅ Review template files to understand output structure
- ✅ Store real credentials in Azure Key Vault or secure password manager
- ✅ Delete generated JSON files after securing credentials
- ✅ Verify `.gitignore` is working before committing changes
- ✅ Use template files as documentation for automation

### ❌ DON'T:
- ❌ Commit files containing real credentials or secrets
- ❌ Email or share real credential files
- ❌ Store real credentials in cloud storage without encryption
- ❌ Modify `.gitignore` to allow credential files
- ❌ Remove the `.example.json` suffix from template files

## Verifying Protection

Before committing changes, verify that sensitive files are excluded:

```powershell
# Check what will be committed
git status

# Verify .gitignore is working
git check-ignore deployment-outputs.json
git check-ignore service-principal-credentials.json

# Should return the filename if properly ignored
```

## Creating New Template Files

If you create a script that generates sensitive output:

1. **Design the output structure** with placeholder values
2. **Create the template file** with `.example.json` suffix
3. **Update `.gitignore`** to exclude the real file
4. **Document in this file** and relevant READMEs
5. **Add note in template** explaining it's an example

Example template note:
```json
{
  "Secret": "YOUR-SECRET-WILL-BE-HERE",
  "Note": "This is an example file. The actual file should NOT be committed to source control."
}
```

## Recovering from Accidental Commits

If sensitive data was accidentally committed:

1. **Immediately rotate all exposed credentials** (service principals, keys, etc.)
2. **Remove from git history** using `git filter-branch` or BFG Repo-Cleaner
3. **Force push** to remote repository (coordinate with team)
4. **Verify** the sensitive data is removed from all branches and tags
5. **Update security incident** in your organization's tracking system

## Questions?

If you're unsure whether a file should be committed:
- **Ask yourself**: "Does this contain production credentials, customer data, or secrets?"
- **If YES**: Do NOT commit. Create a `.example.json` template instead
- **If NO**: Review with team before committing

## Additional Resources

- [GitHub: Ignoring files](https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files)
- [Microsoft: Azure Key Vault best practices](https://learn.microsoft.com/en-us/azure/key-vault/general/best-practices)
- [OWASP: Secrets Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html)
